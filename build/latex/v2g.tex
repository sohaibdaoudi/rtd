%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}

\PassOptionsToPackage{booktabs}{sphinx}
\PassOptionsToPackage{colorrows}{sphinx}

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}



\usepackage{tgtermes}
\usepackage{tgheros}
\renewcommand{\ttdefault}{txtt}



\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}

\fvset{fontsize=auto}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}


\usepackage{sphinxmessages}




\title{v2g}
\date{Jun 08, 2025}
\release{}
\author{Marouane Majidi \& Sohaib Daoudi}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\ifdefined\shorthandoff
  \ifnum\catcode`\=\string=\active\shorthandoff{=}\fi
  \ifnum\catcode`\"=\active\shorthandoff{"}\fi
\fi

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}



\chapter{I. Introduction}
\label{\detokenize{index:i-introduction}}

\section{V2G: Vehicle\sphinxhyphen{}to\sphinxhyphen{}Grid}
\label{\detokenize{index:v2g-vehicle-to-grid}}
\noindent{\hspace*{\fill}\sphinxincludegraphics[width=0.900\linewidth]{{V2G-working}.jpg}\hspace*{\fill}}

\sphinxAtStartPar
\sphinxstylestrong{Vehicle\sphinxhyphen{}to\sphinxhyphen{}Grid (V2G)} is an innovative technology that enables two\sphinxhyphen{}way energy flow between electric vehicles (EVs) and the power grid. Unlike traditional EV charging, V2G allows EVs not only to charge from the grid but also to return stored energy when needed. This capability supports \sphinxstylestrong{grid stability}, \sphinxstylestrong{reduces peak demand}, and enhances the \sphinxstylestrong{integration of renewable energy sources}.

\sphinxAtStartPar
V2G is already being deployed in several countries, including \sphinxstylestrong{Japan}, \sphinxstylestrong{the United States}, \sphinxstylestrong{the United Kingdom}, and \sphinxstylestrong{the Netherlands}, where it helps balance the power grid and reduce energy costs. In Japan, for example, V2G plays a key role in disaster recovery strategies by allowing EVs to power homes and essential services during outages.

\sphinxAtStartPar
This growing ecosystem shows how V2G is becoming a central component in modern smart grid and energy management systems.


\section{Project Overview}
\label{\detokenize{index:project-overview}}
\sphinxAtStartPar
This project introduces an intelligent energy management system that leverages Vehicle\sphinxhyphen{}to\sphinxhyphen{}Grid (V2G) technology to optimize electricity production costs. The system predicts electricity load and the availability of other energy sources to determine the best times to utilize V2G energy, thereby maximizing efficiency and minimizing overall energy costs.


\chapter{II. Team}
\label{\detokenize{index:ii-team}}

\section{Supervisor}
\label{\detokenize{index:supervisor}}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Masrour Tawfik}
\sphinxhref{https://www.linkedin.com/in/tawfik-masrour-43163b85/}{LinkedIn}

\end{itemize}


\section{Members}
\label{\detokenize{index:members}}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Marouane Majidi}
\sphinxhref{https://www.linkedin.com/in/marouane-majidi-73abb81ab/}{LinkedIn}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Sohaib Daoudi}
\sphinxhref{https://www.linkedin.com/in/sohaib-daoudi-61215426a/}{LinkedIn}

\end{itemize}


\chapter{III. Data Collection}
\label{\detokenize{index:iii-data-collection}}

\section{1. MATLAB Simulation}
\label{\detokenize{index:matlab-simulation}}
\sphinxAtStartPar
We implemented a custom \sphinxstylestrong{Vehicle\sphinxhyphen{}to\sphinxhyphen{}Grid (V2G)} simulation in \sphinxstylestrong{MATLAB Simulink}, inspired by the official example from MathWorks:
\sphinxhref{https://www.mathworks.com/help/sps/ug/24-hour-simulation-of-a-vehicle-to-grid-v2g-system.html}{24\sphinxhyphen{}Hour Simulation of a V2G System}.

\sphinxAtStartPar
While our simulation is based on this reference, we made several changes and enhancements to better reflect \sphinxstylestrong{local conditions}, \sphinxstylestrong{vehicle behavior}, and \sphinxstylestrong{energy sources} specific to our use case.

\noindent{\hspace*{\fill}\sphinxincludegraphics[width=0.900\linewidth]{{simulation}.png}\hspace*{\fill}}


\subsection{Input Data}
\label{\detokenize{index:input-data}}
\sphinxAtStartPar
Our simulation required the following inputs:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Solar Irradiance}:
Collected from NASA’s POWER Data Access Viewer:  \sphinxurl{https://power.larc.nasa.gov/}

\sphinxAtStartPar
This dataset provides reliable, global irradiance information and is particularly useful for regions like \sphinxstylestrong{Meknès, Morocco}, where we conducted our case study.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Shading}:
Simulates the effect of clouds on solar irradiance throughout the day.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def}\PYG{+w}{ }\PYG{n+nf}{simulate\PYGZus{}shading}\PYG{p}{(}\PYG{n}{timestamp}\PYG{p}{)}\PYG{p}{:}
\PYG{+w}{    }\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{} Simulate shading factor based on the timestamp.}
\PYG{l+s+sd}{        Returns a value between 0 (full shading) and 1 (no shading).}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{month} \PYG{o}{=} \PYG{n}{timestamp}\PYG{o}{.}\PYG{n}{month}
    \PYG{n}{hour} \PYG{o}{=} \PYG{n}{timestamp}\PYG{o}{.}\PYG{n}{hour}

    \PYG{c+c1}{\PYGZsh{} Summer (June to September) \PYGZhy{} mostly no shading}
    \PYG{k}{if} \PYG{l+m+mi}{6} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{month} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{9}\PYG{p}{:}
        \PYG{n}{base\PYGZus{}shading} \PYG{o}{=} \PYG{l+m+mf}{0.9} \PYG{k}{if} \PYG{l+m+mi}{6} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{hour} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{18} \PYG{k}{else} \PYG{l+m+mf}{0.7}
    \PYG{c+c1}{\PYGZsh{} Winter (November to February) \PYGZhy{} mostly shading}
    \PYG{k}{elif} \PYG{l+m+mi}{11} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{month} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{2}\PYG{p}{:}
        \PYG{n}{base\PYGZus{}shading} \PYG{o}{=} \PYG{l+m+mf}{0.3} \PYG{k}{if} \PYG{l+m+mi}{6} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{hour} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{18} \PYG{k}{else} \PYG{l+m+mf}{0.2}
    \PYG{c+c1}{\PYGZsh{} Spring and Fall (March to May, October)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{base\PYGZus{}shading} \PYG{o}{=} \PYG{l+m+mf}{0.7} \PYG{k}{if} \PYG{l+m+mi}{6} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{hour} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{18} \PYG{k}{else} \PYG{l+m+mf}{0.5}

    \PYG{c+c1}{\PYGZsh{} Introduce random fluctuation for each hour}
    \PYG{n}{fluctuation} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{uniform}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{l+m+mf}{0.1}\PYG{p}{)}
    \PYG{n}{shading\PYGZus{}value} \PYG{o}{=} \PYG{n}{base\PYGZus{}shading} \PYG{o}{+} \PYG{n}{fluctuation}
    \PYG{n}{shading\PYGZus{}value} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{clip}\PYG{p}{(}\PYG{n}{shading\PYGZus{}value}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}

    \PYG{k}{return} \PYG{n+nb}{round}\PYG{p}{(}\PYG{n}{shading\PYGZus{}value}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)}
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Load Profiles}:
Generated using custom Python scripts that simulate residential demand based on Moroccan usage patterns.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def}\PYG{+w}{ }\PYG{n+nf}{generate\PYGZus{}load\PYGZus{}profile}\PYG{p}{(}\PYG{n}{date}\PYG{p}{,} \PYG{n}{hour}\PYG{p}{)}\PYG{p}{:}
\PYG{+w}{    }\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}Generate synthetic load value for given datetime and hour\PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{c+c1}{\PYGZsh{} Base daily pattern (evening peak at \PYGZti{}6:30 PM)}
    \PYG{k}{if} \PYG{n}{date}\PYG{o}{.}\PYG{n}{weekday}\PYG{p}{(}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{l+m+mi}{5}\PYG{p}{:}  \PYG{c+c1}{\PYGZsh{} Weekdays}
        \PYG{n}{base\PYGZus{}pattern} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mf}{0.12}\PYG{p}{,} \PYG{l+m+mf}{0.10}\PYG{p}{,} \PYG{l+m+mf}{0.08}\PYG{p}{,} \PYG{l+m+mf}{0.07}\PYG{p}{,} \PYG{l+m+mf}{0.07}\PYG{p}{,} \PYG{l+m+mf}{0.15}\PYG{p}{,} \PYG{l+m+mf}{0.25}\PYG{p}{,} \PYG{l+m+mf}{0.40}\PYG{p}{,} \PYG{l+m+mf}{0.55}\PYG{p}{,}
        \PYG{l+m+mf}{0.60}\PYG{p}{,} \PYG{l+m+mf}{0.65}\PYG{p}{,} \PYG{l+m+mf}{0.60}\PYG{p}{,} \PYG{l+m+mf}{0.55}\PYG{p}{,} \PYG{l+m+mf}{0.50}\PYG{p}{,} \PYG{l+m+mf}{0.55}\PYG{p}{,} \PYG{l+m+mf}{0.65}\PYG{p}{,} \PYG{l+m+mf}{0.75}\PYG{p}{,} \PYG{l+m+mf}{0.85}\PYG{p}{,} \PYG{l+m+mf}{0.95}\PYG{p}{,} \PYG{l+m+mf}{0.85}\PYG{p}{,}
        \PYG{l+m+mf}{0.70}\PYG{p}{,} \PYG{l+m+mf}{0.50}\PYG{p}{,} \PYG{l+m+mf}{0.30}\PYG{p}{,} \PYG{l+m+mf}{0.20}\PYG{p}{]}

    \PYG{k}{else}\PYG{p}{:}  \PYG{c+c1}{\PYGZsh{} Weekends (Friday \PYGZam{} Saturday)}
        \PYG{n}{base\PYGZus{}pattern} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mf}{0.15}\PYG{p}{,} \PYG{l+m+mf}{0.12}\PYG{p}{,} \PYG{l+m+mf}{0.10}\PYG{p}{,} \PYG{l+m+mf}{0.09}\PYG{p}{,} \PYG{l+m+mf}{0.09}\PYG{p}{,} \PYG{l+m+mf}{0.20}\PYG{p}{,} \PYG{l+m+mf}{0.30}\PYG{p}{,} \PYG{l+m+mf}{0.45}\PYG{p}{,} \PYG{l+m+mf}{0.60}\PYG{p}{,}
        \PYG{l+m+mf}{0.70}\PYG{p}{,} \PYG{l+m+mf}{0.75}\PYG{p}{,} \PYG{l+m+mf}{0.80}\PYG{p}{,} \PYG{l+m+mf}{0.75}\PYG{p}{,} \PYG{l+m+mf}{0.70}\PYG{p}{,} \PYG{l+m+mf}{0.75}\PYG{p}{,} \PYG{l+m+mf}{0.80}\PYG{p}{,} \PYG{l+m+mf}{0.85}\PYG{p}{,} \PYG{l+m+mf}{0.90}\PYG{p}{,} \PYG{l+m+mf}{0.92}\PYG{p}{,} \PYG{l+m+mf}{0.85}\PYG{p}{,}
        \PYG{l+m+mf}{0.75}\PYG{p}{,} \PYG{l+m+mf}{0.60}\PYG{p}{,} \PYG{l+m+mf}{0.40}\PYG{p}{,} \PYG{l+m+mf}{0.25}\PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} Seasonal adjustment (winter = Nov\PYGZhy{}Feb)}
    \PYG{n}{month} \PYG{o}{=} \PYG{n}{date}\PYG{o}{.}\PYG{n}{month}
    \PYG{k}{if} \PYG{n}{month} \PYG{o+ow}{in} \PYG{p}{[}\PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{:}  \PYG{c+c1}{\PYGZsh{} Winter}
        \PYG{n}{multiplier} \PYG{o}{=} \PYG{l+m+mf}{1.25}
    \PYG{k}{elif} \PYG{n}{month} \PYG{o+ow}{in} \PYG{p}{[}\PYG{l+m+mi}{6}\PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{]}\PYG{p}{:}  \PYG{c+c1}{\PYGZsh{} Summer}
        \PYG{n}{multiplier} \PYG{o}{=} \PYG{l+m+mf}{0.85}
    \PYG{k}{else}\PYG{p}{:}  \PYG{c+c1}{\PYGZsh{} Shoulder seasons}
        \PYG{n}{multiplier} \PYG{o}{=} \PYG{l+m+mf}{1.0}

    \PYG{c+c1}{\PYGZsh{} Get base value}
    \PYG{n}{value} \PYG{o}{=} \PYG{n}{base\PYGZus{}pattern}\PYG{p}{[}\PYG{n}{hour}\PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} Apply seasonal multiplier}
    \PYG{n}{value} \PYG{o}{*}\PYG{o}{=} \PYG{n}{multiplier}

    \PYG{c+c1}{\PYGZsh{} Add random fluctuation (\(\pm\)8\PYGZpc{})}
    \PYG{n}{value} \PYG{o}{*}\PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{uniform}\PYG{p}{(}\PYG{l+m+mf}{0.92}\PYG{p}{,} \PYG{l+m+mf}{1.08}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Ensure value \PYGZlt{} 1 and reasonable minimum}
    \PYG{k}{return} \PYG{n+nb}{min}\PYG{p}{(}\PYG{n+nb}{max}\PYG{p}{(}\PYG{n}{value}\PYG{p}{,} \PYG{l+m+mf}{0.05}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{0.99}\PYG{p}{)}
\end{sphinxVerbatim}

\end{itemize}


\subsection{Output Data}
\label{\detokenize{index:output-data}}
\sphinxAtStartPar
Our simulation produces two key output time series:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Total Load}:
Represents the complete electricity demand profile, including both household consumption and vehicle charging requirements.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Solar Energy Production}:
Captures the amount of energy generated by the solar PV system over time, based on irradiance and shading factors.

\end{itemize}


\section{2. Other Data}
\label{\detokenize{index:other-data}}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Diesel Price (Weekly)}:

\sphinxAtStartPar
This data is sourced from the \sphinxstylestrong{U.S. Energy Information Administration (EIA)}: \sphinxhref{https://www.eia.gov/opendata/}{EIA Open Data}

\sphinxAtStartPar
Provides diesel price data in \sphinxstylestrong{USD per gallon}. We use this data when Moroccan sources are unavailable or for comparative analysis.

\sphinxAtStartPar
To convert this data into \sphinxstylestrong{MAD per liter}, we apply the following formula:
\begin{equation*}
\begin{split}\text{MAD_per_liter} = \text{USD_per_gallon} \times 0.26417205 \times 10\end{split}
\end{equation*}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxtitleref{0.26417205} is the conversion factor from gallons to liters.

\item {} 
\sphinxAtStartPar
\sphinxtitleref{10} is the approximate exchange rate used to convert USD to Moroccan Dirham (MAD).

\end{itemize}

\end{itemize}


\section{3. Conclusion}
\label{\detokenize{index:conclusion}}
\sphinxAtStartPar
In summary, our data collection and simulation efforts result in four key time series that serve as the foundation for our energy management analysis:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Load}: Total electricity demand, including residential and vehicle charging (MW).

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Energy Available in EVs}: The energy stored and potentially available in connected electric vehicles through the V2G system (MW).

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Solar Energy}: Energy generated by the solar PV system, influenced by irradiance and shading factors (MW).

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Diesel Price}: Weekly diesel prices in Moroccan Dirham per liter (DH/L).

\end{itemize}

\sphinxAtStartPar
These time series provide comprehensive inputs and outputs for modeling, forecasting, and optimizing the local energy ecosystem.


\chapter{IV. Training Models}
\label{\detokenize{index:iv-training-models}}
\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
All time series are processed through a pipeline that includes the following steps.
Below, we describe the steps for the load time series as an example—other time series follow a similar process.
\end{sphinxadmonition}


\section{1. Data Preparation}
\label{\detokenize{index:data-preparation}}
\sphinxAtStartPar
The time series data comes from a simulation where time is represented in seconds (0, 3600, …, 18907200).
We convert this to hourly timestamps starting from \sphinxcode{\sphinxupquote{2022\sphinxhyphen{}06\sphinxhyphen{}07 00:00:00}} and ending at \sphinxcode{\sphinxupquote{2023\sphinxhyphen{}01\sphinxhyphen{}11 20:00:00}}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{cons\PYGZus{}df} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{read\PYGZus{}excel}\PYG{p}{(}\PYG{n}{dir\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Total\PYGZus{}Load.xlsx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{start\PYGZus{}date} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2022\PYGZhy{}06\PYGZhy{}07 00:00:00}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{cons\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{start\PYGZus{}date} \PYG{o}{+} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}timedelta}\PYG{p}{(}\PYG{n}{cons\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{unit}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{s}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}


\section{2. Statistical Approach}
\label{\detokenize{index:statistical-approach}}

\subsection{2.1. Stationarity Analysis}
\label{\detokenize{index:stationarity-analysis}}

\subsubsection{2.1.1. Visual Inspection}
\label{\detokenize{index:visual-inspection}}
\sphinxAtStartPar
We plot the time series to visually check for stationarity.

\noindent{\hspace*{\fill}\sphinxincludegraphics[width=0.900\linewidth]{{Load_plot}.png}\hspace*{\fill}}


\subsubsection{2.1.2. Augmented Dickey\sphinxhyphen{}Fuller Test}
\label{\detokenize{index:augmented-dickey-fuller-test}}
\sphinxAtStartPar
We apply the Augmented Dickey\sphinxhyphen{}Fuller (ADF) test to check for stationarity. The null hypothesis is that the time series is non\sphinxhyphen{}stationary.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{statsmodels}\PYG{n+nn}{.}\PYG{n+nn}{tsa}\PYG{n+nn}{.}\PYG{n+nn}{stattools}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{adfuller}
\PYG{n}{result} \PYG{o}{=} \PYG{n}{adfuller}\PYG{p}{(}\PYG{n}{cons\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Load}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ADF Statistic: }\PYG{l+s+si}{\PYGZpc{}f}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{result}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{P\PYGZhy{}value: }\PYG{l+s+si}{\PYGZpc{}f}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{result}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}


\subsubsection{2.1.3. Kwiatkowski\sphinxhyphen{}Phillips\sphinxhyphen{}Schmidt\sphinxhyphen{}Shin (KPSS) Test}
\label{\detokenize{index:kwiatkowski-phillips-schmidt-shin-kpss-test}}
\sphinxAtStartPar
The KPSS test checks for stationarity around a deterministic trend. The null hypothesis is that the time series is stationary.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{statsmodels}\PYG{n+nn}{.}\PYG{n+nn}{tsa}\PYG{n+nn}{.}\PYG{n+nn}{stattools}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{kpss}
\PYG{k+kn}{import}\PYG{+w}{ }\PYG{n+nn}{warnings}
\PYG{n}{warnings}\PYG{o}{.}\PYG{n}{filterwarnings}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ignore}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{result} \PYG{o}{=} \PYG{n}{kpss}\PYG{p}{(}\PYG{n}{cons\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Load}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{KPSS Statistic: }\PYG{l+s+si}{\PYGZpc{}f}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{result}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{P\PYGZhy{}value: }\PYG{l+s+si}{\PYGZpc{}f}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{result}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}


\subsubsection{2.1.4. Phillips\sphinxhyphen{}Perron (PP) Test}
\label{\detokenize{index:phillips-perron-pp-test}}
\sphinxAtStartPar
The PP test is another method to check for unit roots in the time series.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{arch}\PYG{n+nn}{.}\PYG{n+nn}{unitroot}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{PhillipsPerron}
\PYG{n}{result} \PYG{o}{=} \PYG{n}{PhillipsPerron}\PYG{p}{(}\PYG{n}{cons\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Load}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{PP Statistic: }\PYG{l+s+si}{\PYGZpc{}f}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{result}\PYG{o}{.}\PYG{n}{stat}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{P\PYGZhy{}value: }\PYG{l+s+si}{\PYGZpc{}f}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{result}\PYG{o}{.}\PYG{n}{pvalue}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{2.2. Differencing}
\label{\detokenize{index:differencing}}
\sphinxAtStartPar
If the time series is non\sphinxhyphen{}stationary, we apply differencing to make it stationary. We check the ADF test again after differencing.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{consumption\PYGZus{}diff} \PYG{o}{=} \PYG{n}{cons\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Load}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{diff}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{dropna}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{2.3. SARIMA Model}
\label{\detokenize{index:sarima-model}}

\subsubsection{2.3.1. Initial Parameter Selection}
\label{\detokenize{index:initial-parameter-selection}}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{ACF \& PACF Analysis}: We plot the autocorrelation function (ACF) and partial autocorrelation function (PACF) to identify potential parameters for the SARIMA model.

\noindent{\hspace*{\fill}\sphinxincludegraphics[width=0.900\linewidth]{{acf_pacf}.png}\hspace*{\fill}}

\end{itemize}

\sphinxAtStartPar
Based on the ACF and PACF plots, we select the initial SARIMA parameters as follows:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{d = 1}: Chosen based on stationarity tests and the need for seasonal differencing.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{p = 24}: Indicated by significant spikes in the PACF plot, suggesting a seasonal autoregressive component.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{q = 23}: Derived from the ACF plot, which shows strong autocorrelations up to lag 23, followed by a sharp drop.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{s = 24}: Represents the seasonal period — 24 hours for daily seasonality in hourly data.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{P = 1}: The seasonal PACF reveals a spike at lag 24 and its multiples (e.g., 48), indicating a seasonal autoregressive pattern.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Q = 1}: The seasonal ACF shows a peak at lag 24, which gradually decays, suggesting a seasonal moving average component.

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{statsmodels}\PYG{n+nn}{.}\PYG{n+nn}{tsa}\PYG{n+nn}{.}\PYG{n+nn}{statespace}\PYG{n+nn}{.}\PYG{n+nn}{sarimax}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{SARIMAX}

\PYG{c+c1}{\PYGZsh{} Define SARIMA parameters}
\PYG{n}{p}\PYG{p}{,} \PYG{n}{d}\PYG{p}{,} \PYG{n}{q} \PYG{o}{=} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{23}
\PYG{n}{P}\PYG{p}{,} \PYG{n}{D}\PYG{p}{,} \PYG{n}{Q}\PYG{p}{,} \PYG{n}{s} \PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{24}
\PYG{c+c1}{\PYGZsh{} P = 0 to avoid the overlap of lags between the seasonal and non\PYGZhy{}seasonal components.}

\PYG{c+c1}{\PYGZsh{} Fit the SARIMA model}
\PYG{n}{model} \PYG{o}{=} \PYG{n}{SARIMAX}\PYG{p}{(}\PYG{n}{train}\PYG{p}{,} \PYG{n}{order}\PYG{o}{=}\PYG{p}{(}\PYG{n}{p}\PYG{p}{,} \PYG{n}{d}\PYG{p}{,} \PYG{n}{q}\PYG{p}{)}\PYG{p}{,} \PYG{n}{seasonal\PYGZus{}order}\PYG{o}{=}\PYG{p}{(}\PYG{n}{P}\PYG{p}{,} \PYG{n}{D}\PYG{p}{,} \PYG{n}{Q}\PYG{p}{,} \PYG{n}{s}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{model\PYGZus{}fit} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}


\subsubsection{2.3.2. Hyperparameter Tuning}
\label{\detokenize{index:hyperparameter-tuning}}
\sphinxAtStartPar
To fine\sphinxhyphen{}tune the SARIMA model parameters, we use the \sphinxtitleref{pmdarima} library’s \sphinxtitleref{auto\_arima} function. This helps identify the optimal combination of non\sphinxhyphen{}seasonal and seasonal parameters by minimizing the AIC score.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import}\PYG{+w}{ }\PYG{n+nn}{pmdarima}\PYG{+w}{ }\PYG{k}{as}\PYG{+w}{ }\PYG{n+nn}{pm}

\PYG{c+c1}{\PYGZsh{} Initial parameter guesses}
\PYG{n}{p}\PYG{p}{,} \PYG{n}{d}\PYG{p}{,} \PYG{n}{q} \PYG{o}{=} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}            \PYG{c+c1}{\PYGZsh{} Non\PYGZhy{}seasonal components}
\PYG{n}{P}\PYG{p}{,} \PYG{n}{D}\PYG{p}{,} \PYG{n}{Q}\PYG{p}{,} \PYG{n}{s} \PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{24}     \PYG{c+c1}{\PYGZsh{} Seasonal components}

\PYG{c+c1}{\PYGZsh{} Perform automatic hyperparameter tuning}
\PYG{n}{auto\PYGZus{}model} \PYG{o}{=} \PYG{n}{pm}\PYG{o}{.}\PYG{n}{auto\PYGZus{}arima}\PYG{p}{(}
    \PYG{n}{train}\PYG{p}{,}
    \PYG{n}{seasonal}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
    \PYG{n}{m}\PYG{o}{=}\PYG{n}{s}\PYG{p}{,}
    \PYG{n}{start\PYGZus{}p}\PYG{o}{=}\PYG{n}{p}\PYG{p}{,} \PYG{n}{start\PYGZus{}q}\PYG{o}{=}\PYG{n}{q}\PYG{p}{,} \PYG{n}{start\PYGZus{}P}\PYG{o}{=}\PYG{n}{P}\PYG{p}{,} \PYG{n}{start\PYGZus{}Q}\PYG{o}{=}\PYG{n}{Q}\PYG{p}{,}
    \PYG{n}{max\PYGZus{}p}\PYG{o}{=}\PYG{l+m+mi}{24}\PYG{p}{,} \PYG{n}{max\PYGZus{}q}\PYG{o}{=}\PYG{l+m+mi}{24}\PYG{p}{,} \PYG{n}{max\PYGZus{}P}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{max\PYGZus{}Q}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{max\PYGZus{}D}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,}
    \PYG{n}{d}\PYG{o}{=}\PYG{n}{d}\PYG{p}{,}
    \PYG{n}{trace}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
    \PYG{n}{error\PYGZus{}action}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ignore}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{n}{suppress\PYGZus{}warnings}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
    \PYG{n}{n\PYGZus{}jobs}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}
\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
The tuning process identified the \sphinxstylestrong{optimal SARIMA parameters} that minimized the AIC:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{(p, d, q) = (3, 0, 7)}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{(P, D, Q, s) = (1, 1, 1, 24)}

\end{itemize}

\sphinxAtStartPar
The model achieved the \sphinxstylestrong{lowest AIC score} of \sphinxstylestrong{13406.305} with these settings.


\subsection{2.4. Prophet Model}
\label{\detokenize{index:prophet-model}}
\sphinxAtStartPar
We use the \sphinxtitleref{Prophet} library to model the time series, which is particularly effective for capturing seasonality and trends in time series data.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{prophet}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{Prophet}

\PYG{c+c1}{\PYGZsh{} Prepare the data for Prophet}
\PYG{n}{prophet\PYGZus{}df} \PYG{o}{=} \PYG{n}{cons\PYGZus{}df}\PYG{o}{.}\PYG{n}{rename}\PYG{p}{(}\PYG{n}{columns}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ds}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Load}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{y}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Initialize and fit the Prophet model}
\PYG{n}{prophet\PYGZus{}model} \PYG{o}{=} \PYG{n}{Prophet}\PYG{p}{(}
    \PYG{n}{daily\PYGZus{}seasonality}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
    \PYG{n}{yearly\PYGZus{}seasonality}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,}
    \PYG{n}{weekly\PYGZus{}seasonality}\PYG{o}{=}\PYG{k+kc}{False}
\PYG{p}{)}
\PYG{n}{prophet\PYGZus{}model}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{prophet\PYGZus{}df}\PYG{p}{)}
\end{sphinxVerbatim}


\section{3. Deep Learning Approach}
\label{\detokenize{index:deep-learning-approach}}

\subsection{3.1. Data Preparation}
\label{\detokenize{index:id1}}
\sphinxAtStartPar
To train deep learning models such as LSTM or GRU, we first format the time series into sequences suitable for supervised learning.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def}\PYG{+w}{ }\PYG{n+nf}{create\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{serie}\PYG{p}{,} \PYG{n}{time\PYGZus{}steps}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{Xs}\PYG{p}{,} \PYG{n}{ys} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{serie}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{time\PYGZus{}steps}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{Xs}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{serie}\PYG{o}{.}\PYG{n}{iloc}\PYG{p}{[}\PYG{n}{i}\PYG{p}{:}\PYG{p}{(}\PYG{n}{i} \PYG{o}{+} \PYG{n}{time\PYGZus{}steps}\PYG{p}{)}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
        \PYG{n}{ys}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{serie}\PYG{o}{.}\PYG{n}{iloc}\PYG{p}{[}\PYG{n}{i} \PYG{o}{+} \PYG{n}{time\PYGZus{}steps}\PYG{p}{]}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{n}{Xs}\PYG{p}{)}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{n}{ys}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
We also scale the data using \sphinxcode{\sphinxupquote{MinMaxScaler}} to normalize the values between 0 and 1, which improves convergence and training stability for neural networks.


\subsection{3.2. Models}
\label{\detokenize{index:models}}
\sphinxAtStartPar
We train various deep learning models, including LSTM, GRU, RNN, and Bidirectional LSTM, on the prepared data. Each model is evaluated using performance metrics such as RMSE and MAE.

\sphinxAtStartPar
We use \sphinxtitleref{Keras Tuner} to automatically search for the best hyperparameters.

\sphinxAtStartPar
\sphinxstylestrong{Example: RNN Model with Keras Tuner and GPU Strategy}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import}\PYG{+w}{ }\PYG{n+nn}{tensorflow}\PYG{+w}{ }\PYG{k}{as}\PYG{+w}{ }\PYG{n+nn}{tf}
\PYG{k+kn}{import}\PYG{+w}{ }\PYG{n+nn}{keras\PYGZus{}tuner}\PYG{+w}{ }\PYG{k}{as}\PYG{+w}{ }\PYG{n+nn}{kt}
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{tensorflow}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{keras}

\PYG{c+c1}{\PYGZsh{} Enable GPU support with distributed strategy}
\PYG{n}{strategy} \PYG{o}{=} \PYG{n}{tf}\PYG{o}{.}\PYG{n}{distribute}\PYG{o}{.}\PYG{n}{MirroredStrategy}\PYG{p}{(}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Number of devices: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{strategy}\PYG{o}{.}\PYG{n}{num\PYGZus{}replicas\PYGZus{}in\PYGZus{}sync}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{k}{def}\PYG{+w}{ }\PYG{n+nf}{model\PYGZus{}builder\PYGZus{}simpleRNN}\PYG{p}{(}\PYG{n}{hp}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{model} \PYG{o}{=} \PYG{n}{tf}\PYG{o}{.}\PYG{n}{keras}\PYG{o}{.}\PYG{n}{Sequential}\PYG{p}{(}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Hyperparameter search space}
    \PYG{n}{hp\PYGZus{}units} \PYG{o}{=} \PYG{n}{hp}\PYG{o}{.}\PYG{n}{Int}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{min\PYGZus{}value}\PYG{o}{=}\PYG{l+m+mi}{32}\PYG{p}{,} \PYG{n}{max\PYGZus{}value}\PYG{o}{=}\PYG{l+m+mi}{512}\PYG{p}{,} \PYG{n}{step}\PYG{o}{=}\PYG{l+m+mi}{32}\PYG{p}{)}
    \PYG{n}{hp\PYGZus{}activation} \PYG{o}{=} \PYG{n}{hp}\PYG{o}{.}\PYG{n}{Choice}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{activation}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{relu}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tanh}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{.}\PYG{n}{add}\PYG{p}{(}\PYG{n}{tf}\PYG{o}{.}\PYG{n}{keras}\PYG{o}{.}\PYG{n}{layers}\PYG{o}{.}\PYG{n}{SimpleRNN}\PYG{p}{(}\PYG{n}{units}\PYG{o}{=}\PYG{n}{hp\PYGZus{}units}\PYG{p}{,} \PYG{n}{activation}\PYG{o}{=}\PYG{n}{hp\PYGZus{}activation}\PYG{p}{,} \PYG{n}{input\PYGZus{}shape}\PYG{o}{=}\PYG{p}{(}\PYG{n}{window\PYGZus{}size}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{model}\PYG{o}{.}\PYG{n}{add}\PYG{p}{(}\PYG{n}{tf}\PYG{o}{.}\PYG{n}{keras}\PYG{o}{.}\PYG{n}{layers}\PYG{o}{.}\PYG{n}{Dense}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{activation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{relu}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

    \PYG{n}{hp\PYGZus{}learning\PYGZus{}rate} \PYG{o}{=} \PYG{n}{hp}\PYG{o}{.}\PYG{n}{Choice}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{learning\PYGZus{}rate}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1e\PYGZhy{}2}\PYG{p}{,} \PYG{l+m+mf}{1e\PYGZhy{}3}\PYG{p}{,} \PYG{l+m+mf}{1e\PYGZhy{}4}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{model}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{n}{optimizer}\PYG{o}{=}\PYG{n}{keras}\PYG{o}{.}\PYG{n}{optimizers}\PYG{o}{.}\PYG{n}{Adam}\PYG{p}{(}\PYG{n}{learning\PYGZus{}rate}\PYG{o}{=}\PYG{n}{hp\PYGZus{}learning\PYGZus{}rate}\PYG{p}{)}\PYG{p}{,}
                  \PYG{n}{loss}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mse}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{model}

\PYG{n}{stop\PYGZus{}early} \PYG{o}{=} \PYG{n}{tf}\PYG{o}{.}\PYG{n}{keras}\PYG{o}{.}\PYG{n}{callbacks}\PYG{o}{.}\PYG{n}{EarlyStopping}\PYG{p}{(}\PYG{n}{monitor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{val\PYGZus{}loss}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{patience}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Run the hyperparameter search within GPU scope}
\PYG{k}{with} \PYG{n}{strategy}\PYG{o}{.}\PYG{n}{scope}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{tuner\PYGZus{}simRNN} \PYG{o}{=} \PYG{n}{kt}\PYG{o}{.}\PYG{n}{Hyperband}\PYG{p}{(}
        \PYG{n}{model\PYGZus{}builder\PYGZus{}simpleRNN}\PYG{p}{,}
        \PYG{n}{objective}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{val\PYGZus{}loss}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{n}{max\PYGZus{}epochs}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{,}
        \PYG{n}{factor}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{,}
        \PYG{n}{directory}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{my\PYGZus{}dir}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{n}{project\PYGZus{}name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{simpleRNN}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{p}{)}

\PYG{n}{tuner\PYGZus{}simRNN}\PYG{o}{.}\PYG{n}{search}\PYG{p}{(}\PYG{n}{X\PYGZus{}train}\PYG{p}{,} \PYG{n}{y\PYGZus{}train}\PYG{p}{,} \PYG{n}{epochs}\PYG{o}{=}\PYG{l+m+mi}{50}\PYG{p}{,} \PYG{n}{validation\PYGZus{}data}\PYG{o}{=}\PYG{p}{(}\PYG{n}{X\PYGZus{}val}\PYG{p}{,} \PYG{n}{y\PYGZus{}val}\PYG{p}{)}\PYG{p}{,} \PYG{n}{callbacks}\PYG{o}{=}\PYG{p}{[}\PYG{n}{stop\PYGZus{}early}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{3.3. Model Evaluation}
\label{\detokenize{index:model-evaluation}}
\sphinxAtStartPar
we evaluate the trained models on a test set using metrics such as Mean Squared Error (MSE), Mean Absolute Error (MAE), and R\sphinxhyphen{}squared (R\(\sp{\text{2}}\)).
we choose the best\sphinxhyphen{}performing model based on these metrics.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{sklearn}\PYG{n+nn}{.}\PYG{n+nn}{metrics}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{r2\PYGZus{}score}

\PYG{n}{mse\PYGZus{}lstm} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{(}\PYG{n}{predictions\PYGZus{}lstm} \PYG{o}{\PYGZhy{}} \PYG{n}{y\PYGZus{}test}\PYG{p}{)} \PYG{o}{*}\PYG{o}{*} \PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{n}{mae\PYGZus{}lstm} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{abs}\PYG{p}{(}\PYG{n}{predictions\PYGZus{}lstm} \PYG{o}{\PYGZhy{}} \PYG{n}{y\PYGZus{}test}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{r2\PYGZus{}lstm} \PYG{o}{=} \PYG{n}{r2\PYGZus{}score}\PYG{p}{(}\PYG{n}{y\PYGZus{}test}\PYG{p}{,} \PYG{n}{predictions\PYGZus{}lstm}\PYG{p}{)}

\PYG{n}{mse\PYGZus{}rnn} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{(}\PYG{n}{predictions\PYGZus{}rnn} \PYG{o}{\PYGZhy{}} \PYG{n}{y\PYGZus{}test}\PYG{p}{)} \PYG{o}{*}\PYG{o}{*} \PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{n}{mae\PYGZus{}rnn} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{abs}\PYG{p}{(}\PYG{n}{predictions\PYGZus{}rnn} \PYG{o}{\PYGZhy{}} \PYG{n}{y\PYGZus{}test}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{r2\PYGZus{}rnn} \PYG{o}{=} \PYG{n}{r2\PYGZus{}score}\PYG{p}{(}\PYG{n}{y\PYGZus{}test}\PYG{p}{,} \PYG{n}{predictions\PYGZus{}rnn}\PYG{p}{)}

\PYG{n}{mse\PYGZus{}gru} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{(}\PYG{n}{predictions\PYGZus{}gru} \PYG{o}{\PYGZhy{}} \PYG{n}{y\PYGZus{}test}\PYG{p}{)} \PYG{o}{*}\PYG{o}{*} \PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{n}{mae\PYGZus{}gru} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{abs}\PYG{p}{(}\PYG{n}{predictions\PYGZus{}gru} \PYG{o}{\PYGZhy{}} \PYG{n}{y\PYGZus{}test}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{r2\PYGZus{}gru} \PYG{o}{=} \PYG{n}{r2\PYGZus{}score}\PYG{p}{(}\PYG{n}{y\PYGZus{}test}\PYG{p}{,} \PYG{n}{predictions\PYGZus{}gru}\PYG{p}{)}


\PYG{n}{mse\PYGZus{}cnn} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{(}\PYG{n}{predictions\PYGZus{}cnn} \PYG{o}{\PYGZhy{}} \PYG{n}{y\PYGZus{}test}\PYG{p}{)} \PYG{o}{*}\PYG{o}{*} \PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{n}{mae\PYGZus{}cnn} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{abs}\PYG{p}{(}\PYG{n}{predictions\PYGZus{}cnn} \PYG{o}{\PYGZhy{}} \PYG{n}{y\PYGZus{}test}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{r2\PYGZus{}cnn} \PYG{o}{=} \PYG{n}{r2\PYGZus{}score}\PYG{p}{(}\PYG{n}{y\PYGZus{}test}\PYG{p}{,} \PYG{n}{predictions\PYGZus{}cnn}\PYG{p}{)}

\PYG{n}{mse\PYGZus{}bi\PYGZus{}lstm} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{(}\PYG{n}{predictions\PYGZus{}bi\PYGZus{}lstm} \PYG{o}{\PYGZhy{}} \PYG{n}{y\PYGZus{}test}\PYG{p}{)} \PYG{o}{*}\PYG{o}{*} \PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{n}{mae\PYGZus{}bi\PYGZus{}lstm} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{abs}\PYG{p}{(}\PYG{n}{predictions\PYGZus{}bi\PYGZus{}lstm} \PYG{o}{\PYGZhy{}} \PYG{n}{y\PYGZus{}test}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{r2\PYGZus{}bi\PYGZus{}lstm} \PYG{o}{=} \PYG{n}{r2\PYGZus{}score}\PYG{p}{(}\PYG{n}{y\PYGZus{}test}\PYG{p}{,} \PYG{n}{predictions\PYGZus{}bi\PYGZus{}lstm}\PYG{p}{)}
\end{sphinxVerbatim}

\noindent{\hspace*{\fill}\sphinxincludegraphics[width=0.900\linewidth]{{comparaison}.png}\hspace*{\fill}}


\chapter{V. Optimisation}
\label{\detokenize{index:v-optimisation}}
\sphinxAtStartPar
The optimization phase focuses on determining the optimal times to utilize V2G energy based on the predicted load and available energy from solar PV systems.
The goal is to minimize electricity costs while ensuring grid stability.


\section{1. Optimization Problem Formulation}
\label{\detokenize{index:optimization-problem-formulation}}
\sphinxAtStartPar
\sphinxstylestrong{Mathematical Formulation}

\sphinxAtStartPar
\sphinxstylestrong{Objective:} Minimize the total energy cost over a time horizon of \(T\) hours.
\begin{equation*}
\begin{split}\min_{d_t, v_t, s_t} \sum_{t=1}^{T} \left( d_t \cdot p_t^{\text{diesel}} + v_t \cdot p^{\text{v2g}} \right)\end{split}
\end{equation*}
\sphinxAtStartPar
\sphinxstylestrong{Subject to the following constraints:}
\begin{equation*}
\begin{split}\text{(1) Energy balance:} \quad s_t + v_t + d_t \geq L_t \quad \forall t = 1, \dots, T\end{split}
\end{equation*}\begin{equation*}
\begin{split}\text{(2) Solar availability:} \quad s_t \leq S_t \quad \forall t\end{split}
\end{equation*}\begin{equation*}
\begin{split}\text{(3) V2G availability:} \quad v_t \leq V_t \quad \forall t\end{split}
\end{equation*}\begin{equation*}
\begin{split}\text{(4) V2G binary activation:} \quad v_t \leq M \cdot b_t \quad \forall t\end{split}
\end{equation*}\begin{equation*}
\begin{split}\text{(5) Max V2G usage hours per day:} \quad \sum_{t \in \mathcal{D}_k} b_t \leq H_{\text{v2g}} \quad \forall \text{day } k\end{split}
\end{equation*}
\begin{sphinxadmonition}{note}{Remark}

\sphinxAtStartPar
Although some constraints (such as energy balance, solar availability, …) logically suggest an equality (i.e., total energy supplied equals total demand), we use a “greater than or equal to” (\(\geq\)) formulation.
This provides numerical flexibility to the solver, avoids infeasibility due to rounding or prediction errors, and ensures better convergence when dealing with real\sphinxhyphen{}world uncertainties in the data.
\end{sphinxadmonition}

\sphinxAtStartPar
\sphinxstylestrong{Variable Definitions:}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\(T\): Total number of hours

\item {} 
\sphinxAtStartPar
\(L_t\): Predicted load at hour \(t\)

\item {} 
\sphinxAtStartPar
\(S_t\): Predicted solar availability at hour \(t\)

\item {} 
\sphinxAtStartPar
\(V_t\): Predicted V2G availability at hour \(t\)

\item {} 
\sphinxAtStartPar
\(d_t\): Diesel energy used at hour \(t\)

\item {} 
\sphinxAtStartPar
\(v_t\): V2G energy used at hour \(t\)

\item {} 
\sphinxAtStartPar
\(s_t\): Solar energy used at hour \(t\)

\item {} 
\sphinxAtStartPar
\(p_t^{\text{diesel}}\): Diesel price at hour \(t\)

\item {} 
\sphinxAtStartPar
\(p^{\text{v2g}}\): Fixed price per unit of V2G energy

\item {} 
\sphinxAtStartPar
\(b_t \in \{0,1\}\): Binary variable indicating whether V2G is used at hour \(t\)

\item {} 
\sphinxAtStartPar
\(M\): Large constant (big\sphinxhyphen{}M) used to link \(v_t\) and \(b_t\)

\item {} 
\sphinxAtStartPar
\(\mathcal{D}_k\): Set of hour indices in day \(k\)

\item {} 
\sphinxAtStartPar
\(H_{\text{v2g}}\): Maximum number of hours per day where V2G can be used

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import}\PYG{+w}{ }\PYG{n+nn}{cvxpy}\PYG{+w}{ }\PYG{k}{as}\PYG{+w}{ }\PYG{n+nn}{cp}

\PYG{k}{def}\PYG{+w}{ }\PYG{n+nf}{optimize\PYGZus{}with\PYGZus{}v2g}\PYG{p}{(}\PYG{n}{load\PYGZus{}pred}\PYG{p}{,} \PYG{n}{solar\PYGZus{}pred}\PYG{p}{,} \PYG{n}{v2g\PYGZus{}pred}\PYG{p}{,} \PYG{n}{hours}\PYG{p}{,} \PYG{n}{diesel\PYGZus{}prices}\PYG{p}{,} \PYG{n}{v2g\PYGZus{}price}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{,} \PYG{n}{max\PYGZus{}v2g\PYGZus{}hours}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{:}
\PYG{+w}{    }\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Optimize energy usage with V2G integration.}

\PYG{l+s+sd}{    Parameters:}
\PYG{l+s+sd}{    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}
\PYG{l+s+sd}{    load\PYGZus{}pred : array\PYGZhy{}like}
\PYG{l+s+sd}{        Predicted load values}
\PYG{l+s+sd}{    solar\PYGZus{}pred : array\PYGZhy{}like}
\PYG{l+s+sd}{        Predicted solar generation values}
\PYG{l+s+sd}{    v2g\PYGZus{}pred : array\PYGZhy{}like}
\PYG{l+s+sd}{        Predicted V2G availability values}
\PYG{l+s+sd}{    hours : int}
\PYG{l+s+sd}{        Number of hours to optimize}
\PYG{l+s+sd}{    diesel\PYGZus{}prices : array\PYGZhy{}like}
\PYG{l+s+sd}{        Hourly diesel prices in MAD/MWh (can be constant or time\PYGZhy{}varying)}
\PYG{l+s+sd}{    v2g\PYGZus{}price : float}
\PYG{l+s+sd}{        Price of V2G energy in MAD/MWh}
\PYG{l+s+sd}{    max\PYGZus{}v2g\PYGZus{}hours : int}
\PYG{l+s+sd}{        Maximum hours per day to use V2G}

\PYG{l+s+sd}{    Returns:}
\PYG{l+s+sd}{    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}
\PYG{l+s+sd}{    dict}
\PYG{l+s+sd}{        Optimization results}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{c+c1}{\PYGZsh{} Decision variables}
        \PYG{n}{solar\PYGZus{}used} \PYG{o}{=} \PYG{n}{cp}\PYG{o}{.}\PYG{n}{Variable}\PYG{p}{(}\PYG{n}{hours}\PYG{p}{,} \PYG{n}{nonneg}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
        \PYG{n}{v2g\PYGZus{}used} \PYG{o}{=} \PYG{n}{cp}\PYG{o}{.}\PYG{n}{Variable}\PYG{p}{(}\PYG{n}{hours}\PYG{p}{,} \PYG{n}{nonneg}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
        \PYG{n}{diesel\PYGZus{}used} \PYG{o}{=} \PYG{n}{cp}\PYG{o}{.}\PYG{n}{Variable}\PYG{p}{(}\PYG{n}{hours}\PYG{p}{,} \PYG{n}{nonneg}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} Objective function: Minimize total cost with time\PYGZhy{}varying diesel prices}
        \PYG{n}{total\PYGZus{}cost} \PYG{o}{=} \PYG{p}{(}\PYG{n}{cp}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{cp}\PYG{o}{.}\PYG{n}{multiply}\PYG{p}{(}\PYG{n}{diesel\PYGZus{}used}\PYG{p}{,} \PYG{n}{diesel\PYGZus{}prices}\PYG{p}{)}\PYG{p}{)} \PYG{o}{+}
                    \PYG{n}{cp}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{cp}\PYG{o}{.}\PYG{n}{multiply}\PYG{p}{(}\PYG{n}{v2g\PYGZus{}used}\PYG{p}{,} \PYG{n}{v2g\PYGZus{}price}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{objective} \PYG{o}{=} \PYG{n}{cp}\PYG{o}{.}\PYG{n}{Minimize}\PYG{p}{(}\PYG{n}{total\PYGZus{}cost}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} Constraints}
        \PYG{n}{constraints} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

        \PYG{k}{for} \PYG{n}{t} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{hours}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{constraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{solar\PYGZus{}used}\PYG{p}{[}\PYG{n}{t}\PYG{p}{]} \PYG{o}{+} \PYG{n}{v2g\PYGZus{}used}\PYG{p}{[}\PYG{n}{t}\PYG{p}{]} \PYG{o}{+} \PYG{n}{diesel\PYGZus{}used}\PYG{p}{[}\PYG{n}{t}\PYG{p}{]} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{n}{load\PYGZus{}pred}\PYG{p}{[}\PYG{n}{t}\PYG{p}{]}\PYG{p}{)}
            \PYG{n}{constraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{solar\PYGZus{}used}\PYG{p}{[}\PYG{n}{t}\PYG{p}{]} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{solar\PYGZus{}pred}\PYG{p}{[}\PYG{n}{t}\PYG{p}{]}\PYG{p}{)}
            \PYG{n}{constraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{v2g\PYGZus{}used}\PYG{p}{[}\PYG{n}{t}\PYG{p}{]} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{v2g\PYGZus{}pred}\PYG{p}{[}\PYG{n}{t}\PYG{p}{]}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} V2G usage time constraint}
        \PYG{n}{v2g\PYGZus{}binary} \PYG{o}{=} \PYG{n}{cp}\PYG{o}{.}\PYG{n}{Variable}\PYG{p}{(}\PYG{n}{hours}\PYG{p}{,} \PYG{n}{boolean}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
        \PYG{n}{M} \PYG{o}{=} \PYG{l+m+mi}{1000}  \PYG{c+c1}{\PYGZsh{} Big\PYGZhy{}M value}

        \PYG{k}{for} \PYG{n}{t} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{hours}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{constraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{v2g\PYGZus{}used}\PYG{p}{[}\PYG{n}{t}\PYG{p}{]} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{M} \PYG{o}{*} \PYG{n}{v2g\PYGZus{}binary}\PYG{p}{[}\PYG{n}{t}\PYG{p}{]}\PYG{p}{)}

        \PYG{n}{days} \PYG{o}{=} \PYG{p}{(}\PYG{n}{hours} \PYG{o}{+} \PYG{l+m+mi}{23}\PYG{p}{)} \PYG{o}{/}\PYG{o}{/} \PYG{l+m+mi}{24}  \PYG{c+c1}{\PYGZsh{} Number of full or partial days}
        \PYG{k}{for} \PYG{n}{d} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{days}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{start} \PYG{o}{=} \PYG{n}{d} \PYG{o}{*} \PYG{l+m+mi}{24}
            \PYG{n}{end} \PYG{o}{=} \PYG{n+nb}{min}\PYG{p}{(}\PYG{p}{(}\PYG{n}{d} \PYG{o}{+} \PYG{l+m+mi}{1}\PYG{p}{)} \PYG{o}{*} \PYG{l+m+mi}{24}\PYG{p}{,} \PYG{n}{hours}\PYG{p}{)}
            \PYG{n}{constraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{cp}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{v2g\PYGZus{}binary}\PYG{p}{[}\PYG{n}{start}\PYG{p}{:}\PYG{n}{end}\PYG{p}{]}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{max\PYGZus{}v2g\PYGZus{}hours}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} Solve the problem using a solver that supports mixed\PYGZhy{}integer programming}
        \PYG{n}{problem} \PYG{o}{=} \PYG{n}{cp}\PYG{o}{.}\PYG{n}{Problem}\PYG{p}{(}\PYG{n}{objective}\PYG{p}{,} \PYG{n}{constraints}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{solver} \PYG{o+ow}{in} \PYG{p}{[}\PYG{n}{cp}\PYG{o}{.}\PYG{n}{ECOS\PYGZus{}BB}\PYG{p}{,} \PYG{n}{cp}\PYG{o}{.}\PYG{n}{CBC}\PYG{p}{,} \PYG{n}{cp}\PYG{o}{.}\PYG{n}{GLPK\PYGZus{}MI}\PYG{p}{]}\PYG{p}{:}
            \PYG{k}{try}\PYG{p}{:}
                \PYG{k}{if} \PYG{n}{solver} \PYG{o}{==} \PYG{n}{cp}\PYG{o}{.}\PYG{n}{ECOS\PYGZus{}BB}\PYG{p}{:}
                    \PYG{n}{problem}\PYG{o}{.}\PYG{n}{solve}\PYG{p}{(}\PYG{n}{solver}\PYG{o}{=}\PYG{n}{solver}\PYG{p}{,} \PYG{n}{abstol}\PYG{o}{=}\PYG{l+m+mf}{1e\PYGZhy{}4}\PYG{p}{,} \PYG{n}{reltol}\PYG{o}{=}\PYG{l+m+mf}{1e\PYGZhy{}4}\PYG{p}{,} \PYG{n}{feastol}\PYG{o}{=}\PYG{l+m+mf}{1e\PYGZhy{}4}\PYG{p}{)}
                \PYG{k}{else}\PYG{p}{:}
                    \PYG{n}{problem}\PYG{o}{.}\PYG{n}{solve}\PYG{p}{(}\PYG{n}{solver}\PYG{o}{=}\PYG{n}{solver}\PYG{p}{)}

                \PYG{k}{if} \PYG{n}{problem}\PYG{o}{.}\PYG{n}{status} \PYG{o+ow}{in} \PYG{p}{[}\PYG{n}{cp}\PYG{o}{.}\PYG{n}{OPTIMAL}\PYG{p}{,} \PYG{n}{cp}\PYG{o}{.}\PYG{n}{OPTIMAL\PYGZus{}INACCURATE}\PYG{p}{]}\PYG{p}{:}
                    \PYG{k}{break}
            \PYG{k}{except}\PYG{p}{:}
                \PYG{k}{continue}

        \PYG{k}{if} \PYG{n}{problem}\PYG{o}{.}\PYG{n}{status} \PYG{o+ow}{not} \PYG{o+ow}{in} \PYG{p}{[}\PYG{n}{cp}\PYG{o}{.}\PYG{n}{OPTIMAL}\PYG{p}{,} \PYG{n}{cp}\PYG{o}{.}\PYG{n}{OPTIMAL\PYGZus{}INACCURATE}\PYG{p}{]}\PYG{p}{:}
            \PYG{k}{return} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{status}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Failed}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{message}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Problem status: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{problem}\PYG{o}{.}\PYG{n}{status}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}

        \PYG{n}{total\PYGZus{}diesel\PYGZus{}cost} \PYG{o}{=} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n+nb}{sum}\PYG{p}{(}\PYG{n}{diesel\PYGZus{}used}\PYG{o}{.}\PYG{n}{value}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{o}{*} \PYG{n}{diesel\PYGZus{}prices}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{hours}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{total\PYGZus{}v2g\PYGZus{}energy} \PYG{o}{=} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{v2g\PYGZus{}used}\PYG{o}{.}\PYG{n}{value}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{total\PYGZus{}v2g\PYGZus{}cost} \PYG{o}{=} \PYG{n}{total\PYGZus{}v2g\PYGZus{}energy} \PYG{o}{*} \PYG{n}{v2g\PYGZus{}price}

        \PYG{k}{return} \PYG{p}{\PYGZob{}}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{status}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Success}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{solar\PYGZus{}used}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{solar\PYGZus{}used}\PYG{o}{.}\PYG{n}{value}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{v2g\PYGZus{}used}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{v2g\PYGZus{}used}\PYG{o}{.}\PYG{n}{value}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{diesel\PYGZus{}used}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{diesel\PYGZus{}used}\PYG{o}{.}\PYG{n}{value}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{total\PYGZus{}diesel\PYGZus{}energy}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{diesel\PYGZus{}used}\PYG{o}{.}\PYG{n}{value}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{total\PYGZus{}diesel\PYGZus{}cost}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{total\PYGZus{}diesel\PYGZus{}cost}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{total\PYGZus{}v2g\PYGZus{}energy}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{total\PYGZus{}v2g\PYGZus{}energy}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{total\PYGZus{}v2g\PYGZus{}cost}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{total\PYGZus{}v2g\PYGZus{}cost}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{total\PYGZus{}cost}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{total\PYGZus{}diesel\PYGZus{}cost} \PYG{o}{+} \PYG{n}{total\PYGZus{}v2g\PYGZus{}cost}
        \PYG{p}{\PYGZcb{}}

    \PYG{k}{except} \PYG{n+ne}{Exception} \PYG{k}{as} \PYG{n}{e}\PYG{p}{:}
        \PYG{k}{return} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{status}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Error}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{message}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{e}\PYG{p}{)}\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}


\section{2. From forecasting to optimization}
\label{\detokenize{index:from-forecasting-to-optimization}}

\subsection{2.1. From diesel price to cost energy}
\label{\detokenize{index:from-diesel-price-to-cost-energy}}
\sphinxAtStartPar
The first challenge is converting the diesel price into the cost of energy generated by the diesel generator. This calculation is based on the methodology from this paper: \sphinxurl{https://www.dpi.nsw.gov.au/\_\_data/assets/pdf\_file/0011/665660/comparing-running-costs-of-diesel-lpg-and-electrical-pumpsets.pdf}

\sphinxAtStartPar
The diesel generator’s cost per MWh is calculated using the following formula.
\begin{equation*}
\begin{split}\text{Cost per MWh} = \left( \frac{\text{Cost per litre}}{\text{Specific energy}} \right) \times \left( \frac{1}{\text{Engine efficiency}} \right) \times \left( \frac{1}{0.278} \right) \times 1000\end{split}
\end{equation*}
\sphinxAtStartPar
Where:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{specific\_energy = 38 (MJ/litre)}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{efficiency = 0.35 (35\% engine efficiency)}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{mj\_to\_kwh = 0.278 (1 MJ = 0.278 kWh)}

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def}\PYG{+w}{ }\PYG{n+nf}{diesel\PYGZus{}cost\PYGZus{}per\PYGZus{}mwh}\PYG{p}{(}\PYG{n}{prices\PYGZus{}mad\PYGZus{}per\PYGZus{}liter}\PYG{p}{)}\PYG{p}{:}
\PYG{+w}{    }\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Calculate the cost per MWh (mechanical energy) from diesel prices (MAD per liter).}

\PYG{l+s+sd}{    Parameters:}
\PYG{l+s+sd}{    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}
\PYG{l+s+sd}{    prices\PYGZus{}mad\PYGZus{}per\PYGZus{}liter : np.ndarray or list}
\PYG{l+s+sd}{        Diesel prices in MAD per liter.}

\PYG{l+s+sd}{    Returns:}
\PYG{l+s+sd}{    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}
\PYG{l+s+sd}{    np.ndarray}
\PYG{l+s+sd}{        Diesel costs in MAD per MWh.}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{c+c1}{\PYGZsh{} Constants}
    \PYG{n}{specific\PYGZus{}energy} \PYG{o}{=} \PYG{l+m+mi}{38}  \PYG{c+c1}{\PYGZsh{} MJ/litre}
    \PYG{n}{efficiency} \PYG{o}{=} \PYG{l+m+mf}{0.35}     \PYG{c+c1}{\PYGZsh{} 35\PYGZpc{} engine efficiency}
    \PYG{n}{mj\PYGZus{}to\PYGZus{}kwh} \PYG{o}{=} \PYG{l+m+mf}{0.278}     \PYG{c+c1}{\PYGZsh{} Conversion factor: 1 MJ = 0.278 kWh}

    \PYG{c+c1}{\PYGZsh{} Compute cost per MWh}
    \PYG{n}{cost\PYGZus{}per\PYGZus{}mwh} \PYG{o}{=} \PYG{p}{(}\PYG{n}{prices\PYGZus{}mad\PYGZus{}per\PYGZus{}liter} \PYG{o}{/} \PYG{n}{specific\PYGZus{}energy}\PYG{p}{)} \PYG{o}{*} \PYG{p}{(}\PYG{l+m+mi}{1} \PYG{o}{/} \PYG{n}{efficiency}\PYG{p}{)} \PYG{o}{*} \PYG{p}{(}\PYG{l+m+mi}{1} \PYG{o}{/} \PYG{n}{mj\PYGZus{}to\PYGZus{}kwh}\PYG{p}{)} \PYG{o}{*} \PYG{l+m+mi}{1000}

    \PYG{k}{return} \PYG{n}{cost\PYGZus{}per\PYGZus{}mwh}
\end{sphinxVerbatim}


\subsection{2.2. From weekly to hourly diesel energy cost}
\label{\detokenize{index:from-weekly-to-hourly-diesel-energy-cost}}
\sphinxAtStartPar
Our diesel prices are provided on a weekly basis, but our energy optimization requires hourly diesel costs.
To address this, we map weekly diesel prices to hourly timestamps by assigning each hour the diesel price from the most recent week available.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def}\PYG{+w}{ }\PYG{n+nf}{map\PYGZus{}weekly\PYGZus{}to\PYGZus{}hourly\PYGZus{}prices}\PYG{p}{(}\PYG{n}{hourly\PYGZus{}dates}\PYG{p}{,} \PYG{n}{diesel\PYGZus{}prices}\PYG{p}{,} \PYG{n}{diesel\PYGZus{}dates}\PYG{p}{)}\PYG{p}{:}
\PYG{+w}{    }\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Map weekly diesel prices to an hourly time series.}

\PYG{l+s+sd}{    For each hourly timestamp, this function assigns the diesel price from the latest}
\PYG{l+s+sd}{    weekly price date that is less than or equal to the hour\PYGZsq{}s date.}

\PYG{l+s+sd}{    Parameters:}
\PYG{l+s+sd}{    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}
\PYG{l+s+sd}{    hourly\PYGZus{}dates : pd.Series or array\PYGZhy{}like}
\PYG{l+s+sd}{        Array of hourly timestamps (datetime).}
\PYG{l+s+sd}{    diesel\PYGZus{}prices : array\PYGZhy{}like}
\PYG{l+s+sd}{        List or array of diesel prices corresponding to weekly intervals.}
\PYG{l+s+sd}{    diesel\PYGZus{}dates : pd.Series or array\PYGZhy{}like}
\PYG{l+s+sd}{        Array of datetime objects indicating the start dates of weekly diesel prices.}

\PYG{l+s+sd}{    Returns:}
\PYG{l+s+sd}{    \PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}
\PYG{l+s+sd}{    np.ndarray}
\PYG{l+s+sd}{        Array of diesel prices mapped to each hourly timestamp.}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{hourly\PYGZus{}diesel\PYGZus{}prices} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{zeros}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{hourly\PYGZus{}dates}\PYG{p}{)}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Ensure datetime format for consistency}
    \PYG{n}{hourly\PYGZus{}dates} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{hourly\PYGZus{}dates}\PYG{p}{)}
    \PYG{n}{diesel\PYGZus{}dates} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{diesel\PYGZus{}dates}\PYG{p}{)}

    \PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{hour\PYGZus{}date} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{hourly\PYGZus{}dates}\PYG{p}{)}\PYG{p}{:}
        \PYG{c+c1}{\PYGZsh{} Identify all diesel price dates that are less than or equal to the current hour}
        \PYG{n}{valid\PYGZus{}dates} \PYG{o}{=} \PYG{n}{diesel\PYGZus{}dates} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{hour\PYGZus{}date}

        \PYG{k}{if} \PYG{n}{valid\PYGZus{}dates}\PYG{o}{.}\PYG{n}{any}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
            \PYG{c+c1}{\PYGZsh{} Use the most recent diesel price available before or at this hour}
            \PYG{n}{closest\PYGZus{}index} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{valid\PYGZus{}dates}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}
            \PYG{n}{hourly\PYGZus{}diesel\PYGZus{}prices}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{o}{=} \PYG{n}{diesel\PYGZus{}prices}\PYG{p}{[}\PYG{n}{closest\PYGZus{}index}\PYG{p}{]}
        \PYG{k}{else}\PYG{p}{:}
            \PYG{c+c1}{\PYGZsh{} If no previous diesel price exists (e.g., very early dates), use the first available price}
            \PYG{n}{hourly\PYGZus{}diesel\PYGZus{}prices}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{o}{=} \PYG{n}{diesel\PYGZus{}prices}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}

    \PYG{k}{return} \PYG{n}{hourly\PYGZus{}diesel\PYGZus{}prices}
\end{sphinxVerbatim}


\subsection{2.3. Example of optimization}
\label{\detokenize{index:example-of-optimization}}
\noindent{\hspace*{\fill}\sphinxincludegraphics[width=0.900\linewidth]{{Optimisation_vis}.png}\hspace*{\fill}}


\chapter{VI. Dashboard with Streamlit}
\label{\detokenize{index:vi-dashboard-with-streamlit}}
\sphinxAtStartPar
To run the application (Dashboard), visit the GitHub repository:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxurl{https://github.com/MarouaneMajidi/Intelligent-Energy-Management-System-with-V2G-Technology}

\item {} 
\sphinxAtStartPar
\sphinxurl{https://github.com/sohaibdaoudi/V2G\_TS\_Project}

\end{itemize}


\section{Main Workflow}
\label{\detokenize{index:main-workflow}}
\sphinxAtStartPar
\sphinxstylestrong{Step 1: Load Models and Set Parameters}

\sphinxAtStartPar
Load the pre\sphinxhyphen{}trained models and historical data. Configure the parameters for optimization:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Forecast duration}: Number of hours for forecasting load and solar energy.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Diesel price input}: Choose between a time series or a constant value.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{V2G price}: Cost of V2G energy in MAD per MWh.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Maximum V2G hours}: Maximum number of hours per day that V2G energy can be used.

\end{itemize}

\noindent{\hspace*{\fill}\sphinxincludegraphics[width=0.900\linewidth]{{step1}.png}\hspace*{\fill}}

\begin{DUlineblock}{0em}
\item[] 
\end{DUlineblock}

\sphinxAtStartPar
\sphinxstylestrong{Step 2: Run Optimization and View Results}

\sphinxAtStartPar
Execute the optimization process and analyze the outcomes visually through interactive plots.

\noindent{\hspace*{\fill}\sphinxincludegraphics[width=0.900\linewidth]{{step2}.png}\hspace*{\fill}}

\begin{DUlineblock}{0em}
\item[] 
\end{DUlineblock}


\section{Additional Features}
\label{\detokenize{index:additional-features}}
\sphinxAtStartPar
\sphinxstylestrong{Download Energy Analysis Results}

\sphinxAtStartPar
Export the energy cost and distribution results in CSV format for external analysis.

\noindent{\hspace*{\fill}\sphinxincludegraphics[width=0.900\linewidth]{{step3}.png}\hspace*{\fill}}

\begin{DUlineblock}{0em}
\item[] 
\end{DUlineblock}

\sphinxAtStartPar
\sphinxstylestrong{Download Summary Report}

\sphinxAtStartPar
Generate and download a detailed energy optimization report in PDF or markdown format.

\noindent{\hspace*{\fill}\sphinxincludegraphics[width=0.900\linewidth]{{step4}.png}\hspace*{\fill}}

\begin{DUlineblock}{0em}
\item[] 
\end{DUlineblock}

\sphinxAtStartPar
\sphinxstylestrong{Retrain Models with Real\sphinxhyphen{}Time Data}

\sphinxAtStartPar
The dashboard allows users to upload real\sphinxhyphen{}world operational data to retrain and update forecasting models.

\noindent{\hspace*{\fill}\sphinxincludegraphics[width=0.900\linewidth]{{step5}.png}\hspace*{\fill}}



\renewcommand{\indexname}{Index}
\printindex
\end{document}